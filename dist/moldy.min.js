!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.moldy=t()}}(function(){return function t(e,r,n){function a(i,s){if(!r[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(o)return o(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=r[i]={exports:{}};e[i][0].call(c.exports,function(t){var r=e[i][1][t];return a(r?r:t)},c,c.exports,t,e,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(t,e){function r(t){return t?n(t):void 0}function n(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},r.prototype.once=function(t,e){function r(){n.off(t,r),e.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=e,this.on(t,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks[t];if(!r)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var n,a=0;a<r.length;a++)if(n=r[a],n===e||n.fn===e){r.splice(a,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks[t];if(r){r=r.slice(0);for(var n=0,a=r.length;a>n;++n)r[n].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],2:[function(t,e){var r=t("sc-contains"),n=t("sc-is"),a=function(t,e,o,i){var s,u=e,c=n.an.array(i)?i:[];switch(!0){case/float|integer/.test(u):u="number"}if(n.a[u](t)||"*"===u)s=t;else switch(!0){case"array"===u:try{if(n.a.string(t)&&(s=JSON.parse(t)),n.not.an.array(s))throw""}catch(p){n.not.nullOrUndefined(t)&&(s=[t])}break;case"boolean"===u:try{s=/^(true|1|y|yes)$/i.test(t.toString())?!0:void 0}catch(p){}if(n.not.a.boolean(s))try{s=/^(false|-1|0|n|no)$/i.test(t.toString())?!1:void 0}catch(p){}s=n.a.boolean(s)?s:void 0;break;case"date"===u:try{s=new Date(t),s=isNaN(s.getTime())?void 0:s}catch(p){}break;case"string"===u:try{if(s=JSON.stringify(t),n.undefined(s))throw""}catch(p){try{s=t.toString()}catch(p){}}break;case"number"===u:try{s=parseFloat(t),(n.not.a.number(s)||isNaN(s))&&(s=void 0)}catch(p){s=void 0}if(void 0!==s)switch(!0){case"integer"===e:s=parseInt(s)}break;default:try{s=a(JSON.parse(t),u)}catch(p){}}return c.length>0&&!r(c,s)&&(s=c[0]),n.not.undefined(s)?s:n.not.undefined(o)?o:null};e.exports=a},{"sc-contains":3,"sc-is":7}],3:[function(t,e){var r=function(t,e){var r=!1;return Array.isArray(t)?t.forEach(function(t){r===!1&&e===t&&(r=!0)}):Object(t)===t&&Object.keys(t).forEach(function(n){r===!1&&t[n]===e&&(r=!0)}),r};e.exports=r},{}],4:[function(t,e,r){var n="{?[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}}?";r.generate=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:7&r|8).toString(16)});return e},r.match=function(t){var e=new RegExp(n,"g"),r=("string"==typeof t?t:"").match(e);return Array.isArray(r)?r:[]},r.isValid=function(t){var e=new RegExp(n);return e.test(t)}},{}],5:[function(t,e){function r(t,e,o){t="object"===n(t)?t:{},e="array"===n(e)?e:[],o="string"===n(o)?o:"";var i=e.length>0?e.shift():"",s=a.call(t,i)||void 0!==t[i],u=s?t[i]:void 0,c=n(u)===o;return e.length>0&&s?r(t[i],e,o):e.length>0||""===o?s:s&&c}var n=t("type-component"),a=Object.prototype.hasOwnProperty;e.exports=function(t,e,a){return e="string"===n(e)?e.split("."):[],r(t,e,a)}},{"type-component":6}],6:[function(t,e){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===t?"null":void 0===t?"undefined":t===Object(t)?"object":typeof t}},{}],7:[function(t,e,r){var n=t("./ises/type"),a={a:{},an:{},not:{a:{},an:{}}},o={arguments:["arguments",n("arguments")],array:["array",n("array")],"boolean":["boolean",n("boolean")],date:["date",n("date")],"function":["function","func","fn",n("function")],"null":["null",n("null")],number:["number","integer","int",n("number")],object:["object",n("object")],regexp:["regexp",n("regexp")],string:["string",n("string")],undefined:["undefined",n("undefined")],empty:["empty",t("./ises/empty")],nullorundefined:["nullOrUndefined","nullorundefined",t("./ises/nullorundefined")],guid:["guid",t("./ises/guid")]};Object.keys(o).forEach(function(t){var e=o[t].slice(0,o[t].length-1),r=o[t][o[t].length-1];e.forEach(function(t){a[t]=a.a[t]=a.an[t]=r,a.not[t]=a.not.a[t]=a.not.an[t]=function(){return r.apply(this,arguments)?!1:!0}})}),r=e.exports=a,r.type=n},{"./ises/empty":8,"./ises/guid":9,"./ises/nullorundefined":10,"./ises/type":11}],8:[function(t,e){var r=t("../type");e.exports=function(t){var e=!1;return"null"===r(t)||"undefined"===r(t)?e=!0:"object"===r(t)?e=0===Object.keys(t).length:"boolean"===r(t)?e=t===!1:"number"===r(t)?e=0===t||-1===t:("array"===r(t)||"string"===r(t))&&(e=0===t.length),e}},{"../type":12}],9:[function(t,e){var r=t("sc-guid");e.exports=function(t){return r.isValid(t)}},{"sc-guid":4}],10:[function(t,e){e.exports=function(t){return null===t||void 0===t||void 0===t}},{}],11:[function(t,e){var r=t("../type");e.exports=function(t){return function(e){return r(e)===t}}},{"../type":12}],12:[function(t,e){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===t?"null":void 0===t?"undefined":t===Object(t)?"object":typeof t}},{}],13:[function(t,e){var r=t("type-component"),n=function(){var t=Array.prototype.slice.call(arguments),e="boolean"===r(t[0])?t.shift():!1,a=t,o={};return a.forEach(function(t){"object"===r(t)&&Object.keys(t).forEach(function(a){Object.prototype.hasOwnProperty.call(t,a)&&(o[a]=e&&"object"===r(t[a])?n(e,{},o[a],t[a]):t[a])})}),o};e.exports=n},{"type-component":14}],14:[function(t,e){e.exports=t(6)},{}],15:[function(t,e){var r=function(t){var e={},r=Array.isArray(t)?t:[],n=function(t){var n=Array.prototype.slice.call(arguments,1);return e[t]?e[t].apply(r,n):r["__"+t].apply(r,n)};return Object.defineProperties(r,{on:{value:function(t,r){e[t]=r}}}),Object.defineProperty(r,"pop",{value:function(){return n("pop",r[r.length-1])}}),Object.defineProperty(r,"__pop",{value:function(){return Array.prototype.pop.apply(r,arguments)}}),Object.defineProperty(r,"shift",{value:function(){return n("shift",r[0])}}),Object.defineProperty(r,"__shift",{value:function(){return Array.prototype.shift.apply(r,arguments)}}),["push","reverse","unshift","sort","splice"].forEach(function(t){var e={};e[t]={value:n.bind(null,t)},e["__"+t]={value:function(){return Array.prototype[t].apply(r,arguments)}},Object.defineProperties(r,e)}),r};e.exports=r},{}],16:[function(t,e){e.exports={defaults:{baseUrl:"",headers:{}}}},{}],17:[function(t,e,r){var n=t("./config.json"),a={adapters:{__default:void 0},use:function(t){if(!(t&&t.name&&t.create&&t.find&&t.findOne&&t.save&&t.destroy))throw new Error("Invalid Adapter");this.adapters.__default||(this.adapters.__default=t),this.adapters[t.name]=t}},o=t("./moldy")(t("./model"),n.defaults,a.adapters);a.extend=function(t,e){return new o(t,e)},r=e.exports=a,r.defaults=n.defaults},{"./config.json":16,"./model":19,"./moldy":20}],18:[function(t,e,r){var n=t("sc-is"),a=t("sc-cast"),o=t("sc-merge");r.attributes=function(t,e){var r;return r=n.a.string(e)?{type:e}:n.an.object(e)&&e.__isMoldy===!0?{type:"moldy","default":e}:e,o({name:t||"",type:"","default":null,optional:!1},r)},r.getProperty=function(t){return function(){return this.__data[t]}},r.destroyedError=function(t){var e="object"==typeof t?t:{};return new Error("The given moldy item `"+e.__name+"` has been destroyed")},r.setBusy=function(t){return function(){t.busy=!0}},r.setProperty=function(t){return function(e){var r=this,n=r.__attributes[t],o=n.type?a(e,n.type,n["default"]):e;r.__data[t]!==o&&r.emit("change",r.__data[t],o),r.__data[t]=o}},r.unsetBusy=function(t){return function(){t.busy=!1}},r.noop=function(){};var i=function(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e)for(var r in e)t[r]=e[r]}),t};r.extend=i,r.extendObject=function(t,e){var r,n=this;r=t&&Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},i(r,n,e);var a=function(){this.constructor=r};return a.prototype=n.prototype,r.prototype=new a,t&&i(r.prototype,t),r.__super__=n.prototype,r}},{"sc-cast":2,"sc-is":7,"sc-merge":13}],19:[function(t,e,r){var n=t("sc-cast"),a=t("emitter-component"),o=t("sc-guid"),i=t("sc-haskey"),s=t("./helpers"),u=t("sc-is"),c=s.extendObject,p=function(t,e){var r=this,a=t||{};this.__moldy=e,this.__isMoldy=!0,this.__attributes={},this.__data={},this.__destroyed=!1,r.__moldy.__keyless||r.__moldy.$defineProperty(r,r.__moldy.__key),Object.keys(n(r.__moldy.__metadata,"object",{})).forEach(function(t){r.__moldy.$defineProperty(r,t,a[t])});for(var o in a)a.hasOwnProperty(o)&&r.__moldy.__metadata[o]&&(this[o]=a[o])};p.prototype.$clear=function(){var t=this;Object.keys(t.__moldy.__metadata).forEach(function(e){if(i(t[e],"__isMoldy","boolean")&&t[e].__isMoldy===!0)t[e].$clear();else if(t.__attributes[e].arrayOfAType)for(;t[e].length>0;)t[e].shift();else t[e]=t.__data[e]=void 0})},p.prototype.$clone=function(t){var e=this.$json();s.extend(e,t||{});var r=this.__moldy.create(e);return r},p.prototype.$data=function(t){var e=this,r=u.object(t)?t:{};return e.__destroyed?s.destroyedError(e):(Object.keys(r).forEach(function(t){e.__attributes.hasOwnProperty(t)&&(u.an.array(r[t])&&i(e.__attributes[t],"arrayOfAType","boolean")&&e.__attributes[t].arrayOfAType===!0?r[t].forEach(function(r){e[t].push(r)}):u.a.object(r[t])&&e[t]instanceof p?e[t].$data(r[t]):e[t]=r[t])}),e)},p.prototype.$destroy=function(t){var e=this,r=o.generate(),n=e.$isDirty(),a=e.$json(),i="delete",c=u.a.func(t)?t:s.noop;return e.__destroyed?c.apply(e,[s.destroyedError(e)]):(e.__moldy.emit("busy",r),e.emit("predestroy",{moldy:e,data:a,method:i,callback:c}),void(n?c&&c(new Error("This moldy cannot be destroyed because it has not been saved to the server yet.")):e.__moldy.__adapter[e.__moldy.__adapterName].destroy.call(e.__moldy,e.$json(),function(t,n){!t||t instanceof Error||(t=new Error("An unknown error occurred")),e.__moldy.emit("busy:done",r),e.emit("destroy",t,n),e.__destroyed=!0,e[e.__moldy.__key]=void 0,c&&c(t,n)})))},p.prototype.$isDirty=function(){return this.__destroyed?!0:u.empty(this[this.__moldy.__key])},p.prototype.$isValid=function(){if(this.__destroyed)return!1;var t=this,e=!0;return Object.keys(t.__attributes).forEach(function(r){if(!t.$isDirty()||r!==t.__moldy.__key){var n=t[r],a=t.__attributes[r],o=a.type,s=i(a,"arrayOfAType","boolean")?a.arrayOfAType===!0:!1,c=a.optional!==!0,l=t.__moldy.__keyless?!1:s?0===n.length:u.nullOrUndefined(n),y=u.not.empty(o)&&u.a.string(o)?u.not.a[o](n):l;s&&u.not.empty(n)&&n[0]instanceof p&&n.forEach(function(t){e&&t.$isValid()===!1&&(e=!1)}),e&&c&&y&&(e=!1)}}),e},p.prototype.$json=function(){var t=this,e=t.__data,r={};return Object.keys(e).forEach(function(t){u.an.array(e[t])&&e[t][0]instanceof p?(r[t]=[],e[t].forEach(function(e){r[t].push(e.$json())})):r[t]=e[t]instanceof p?e[t].$json():e[t]}),r},p.prototype.$save=function(t){var e=this,r=null,n=o.generate(),a=e.$isDirty(),c=e.$json(),p=a?"create":"save",l=u.a.func(t)?t:s.noop;e.__destroyed=!1,e.__moldy.emit("busy",n),e.emit("presave",{moldy:e,data:c,method:p,callback:l});var y=i(c,e.__key)&&u.not.empty(c[e.__key]);e.__moldy.__adapter[e.__moldy.__adapterName][p].call(e.__moldy,c,function(t,o){!t||t instanceof Error||(t=new Error("An unknown error occurred")),!t&&a&&u.object(o)&&y&&!i(o,e.__moldy.__key)&&(t=new Error("The response from the server did not contain a valid `"+e.__moldy.__key+"`")),!t&&a&&u.object(o)&&(e.__moldy[e.__moldy.__key]=o[e.__moldy.__key]),r||e.$data(o),e.emit("save",t,e),e.__moldy.emit("busy:done",n),l&&l(t,e)})},a(p.prototype),p.extend=c,r=e.exports=p},{"./helpers":18,"emitter-component":1,"sc-cast":2,"sc-guid":4,"sc-haskey":5,"sc-is":7}],20:[function(t,e){var r=t("./helpers/index"),n=t("emitter-component"),a=t("sc-guid"),o=t("sg-observable-array"),i=t("sc-haskey"),s=t("sc-is"),u=t("sc-merge"),c=t("sc-cast");e.exports=function(t,e,p){var l=function(t,r){{var n=this,a=s.an.object(r)?r:{};a.initial||{}}Object.defineProperties(n,{__moldy:{value:!0},__properties:{value:a.properties||{}},__adapterName:{value:a.adapter||"__default"},__metadata:{value:{}},__baseUrl:{value:c(a.baseUrl,"string",""),writable:!0},__data:{value:{},writable:!0},__destroyed:{value:!1,writable:!0},__headers:{value:u({},c(a.headers,"object",{}),c(e.headers,"object",{})),writable:!0},__key:{value:c(a.key,"string","id")||"id",writable:!0},__keyless:{value:a.keyless===!0},__name:{value:t||a.name||""},__url:{value:c(a.url,"string",""),writable:!0},busy:{value:!1,writable:!0}}),n.__keyless||this.$property(this.__key),Object.keys(c(n.__properties,"object",{})).forEach(function(t){n.$property(t,n.__properties[t])})};return l.prototype.schema=function(t){return Object.keys(c(t,"object",{})).forEach(function(e){self.$property(e,t[e])}),this},l.prototype.adapter=function(t){if(!t||!this.__adapter[t])throw new Error("Provide a valid adpater ");return this.__adapterName=t,this},l.prototype.proto=function(t){return this.__properties.proto=this.__properties.proto||{},r.extend(this.__properties.proto,t),this},l.prototype.create=function(e){var r=t.extend(this.__properties.proto||{});return new r(e,this)},l.prototype.$headers=function(t){var e=this;return e.__destroyed?r.destroyedError(e):(e.__headers=s.an.object(t)?t:e.__headers,s.not.an.object(t)?e.__headers:e)},l.prototype.$findOne=function(t,e){var n,o=this,i=a.generate(),u=o.$url(),c="findOne",p=s.an.object(t)?t:{},l=s.a.func(t)?t:s.a.func(e)?e:r.noop;wasDestroyed=o.__destroyed,o.emit("busy",i),o.emit("prefindOne",{moldy:o,method:c,query:p,url:u,callback:l}),o.__destroyed=!1,o.__adapter[o.__adapterName].findOne.call(o,p,function(t,e){!t||t instanceof Error||(t=new Error("An unknown error occurred")),t||(n=o.create(s.array(e)?e[0]:e)),o.emit("busy:done",i),o.emit("findOne",t,n),l&&l(t,n)})},l.prototype.$url=function(t){var e=this,r=s.empty(e.$baseUrl())?"":e.$baseUrl(),n=s.empty(e.__name)?"":"/"+e.__name.trim().replace(/^\//,""),a=t||e.__url||"",o=r+n+(s.empty(a)?"":"/"+a.trim().replace(/^\//,""));return e.__url=a.trim().replace(/^\//,""),s.not.a.string(t)?o:e},l.prototype.__adapter=p,l.prototype.$baseUrl=function(t){var r=this,n=c(t,"string",r.__baseUrl||"");return r.__baseUrl=n.trim().replace(/(\/|\s)+$/g,"")||e.baseUrl||"",s.not.a.string(t)?r.__baseUrl:r},l.prototype.$find=function(e,n){var o=this,i=a.generate(),u=o.$url(),p="find",l=[],y=s.an.object(e)?e:{},d=s.a.func(e)?e:s.a.func(n)?n:r.noop;o.emit("busy",i),o.emit("prefind",{moldy:o,method:p,query:y,url:u,callback:d}),o.__adapter[o.__adapterName].find.call(o,y,function(e,r){!e||e instanceof e||(e=new Error("An unknown error occurred")),s.array(r)?r.forEach(function(t){l.push(o.create(t))}):l.push(o.create(_data));var n=c(l instanceof t||s.an.array(l)?l:null,"array",[]);o.emit("busy:done",i),o.emit("find",e,n),d&&d(e,n)})},l.prototype.$defineProperty=function(t,e,n){var a=this,i=t[e]||n,u=a.__metadata[e];if(!t.hasOwnProperty(e)||!t.__attributes.hasOwnProperty(e)){if((u.valueIsAnArrayMoldy||u.valueIsAnArrayString)&&(u.attributes.type=u.value,u.attributeArrayTypeIsAMoldy=u.valueIsAnArrayMoldy,u.attributeArrayTypeIsAString=u.valueIsAnArrayString,u.attributeTypeIsAnArray=!0),u.attributeTypeIsAnInstantiatedMoldy)Object.defineProperty(t,e,{value:u.attributes["default"],enumerable:!0}),t.__data[e]=t[e];else if(u.valueIsAStaticMoldy)Object.defineProperty(t,e,{value:new l(u.value.name,u.value).create(),enumerable:!0}),t.__data[e]=t[e];else if(u.attributeTypeIsAnArray){var p=o([]),y=u.attributeArrayTypeIsAString||u.attributeArrayTypeIsAMoldy?u.attributes.type[0]:"*";u.attributes.arrayOfAType=!0,Object.defineProperty(t,e,{value:p,enumerable:!0}),t.__data[e]=t[e],["push","unshift"].forEach(function(t){p.on(t,function(){var e=Array.prototype.slice.call(arguments),r=[];return e.forEach(function(t){if(u.attributeArrayTypeIsAMoldy){var e=new l(y.name,y),n=s.an.object(t)?t:u.attributes["default"];r.push(e.create(n))}else r.push(c(t,y,u.attributes["default"]))}),p["__"+t].apply(p,r)})}),i&&i.length>0&&i.forEach(function(r){t[e].push(r)})}else Object.defineProperty(t,e,{get:r.getProperty(e),set:r.setProperty(e),enumerable:!0});t.__attributes[e]=u.attributes}void 0!==i?t[e]=i:s.empty(t[e])&&u.attributes.optional===!1&&s.not.nullOrUndefined(u.attributes["default"])?t[e]=u.attributes["default"]:s.empty(t[e])&&u.attributes.optional===!1&&(t.__data[e]=u.attributeTypeIsAnArray||u.attributeTypeIsAnInstantiatedMoldy?t[e]:s.empty(u.attributes.type)?void 0:c(void 0,u.attributes.type))},l.prototype.$property=function(t,e){var n=this,a=new r.attributes(t,e),o=s.a.string(a.type)&&/moldy/.test(a.type),u=s.an.array(a.type),c=s.an.array(e)&&i(e[0],"properties","object"),p=s.an.array(e)&&s.a.string(e[0]),l=u&&i(a.type[0],"properties","object"),y=u&&s.a.string(a.type[0])&&s.not.empty(a.type[0]),d=i(e,"properties","object");return n.__metadata[t]={attributes:a,value:e,attributeTypeIsAnInstantiatedMoldy:o,attributeTypeIsAnArray:u,valueIsAnArrayMoldy:c,valueIsAnArrayString:p,attributeArrayTypeIsAMoldy:l,attributeArrayTypeIsAString:y,valueIsAStaticMoldy:d},n},n(l.prototype),l}},{"./helpers/index":18,"emitter-component":1,"sc-cast":2,"sc-guid":4,"sc-haskey":5,"sc-is":7,"sc-merge":13,"sg-observable-array":15}]},{},[17])(17)});