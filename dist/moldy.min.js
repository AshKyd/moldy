!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.moldy=e()}}(function(){return function e(t,r,n){function a(i,s){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(o)return o(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=r[i]={exports:{}};t[i][0].call(c.exports,function(e){var r=t[i][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,t,r){function n(e){return e?a(e):void 0}function a(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var n,a=0;a<r.length;a++)if(n=r[a],n===t||n.fn===t){r.splice(a,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var n=0,a=r.length;a>n;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],2:[function(e,t,r){var n=e("sc-contains"),a=e("sc-is"),o=function(e,t,r,i,s){var u,c,l=t.toLowerCase(),p=a.an.array(i)?i:[];switch(!0){case/float|integer/.test(l):l="number"}if(a.a.hasOwnProperty(l)?c=a.a[l](e):"*"===l&&(c=!0),c)u=e;else switch(!0){case"array"===l:try{if(a.a.string(e)&&(u=JSON.parse(e)),a.not.an.array(u))throw""}catch(y){a.not.nullOrUndefined(e)&&(u=[e])}break;case"boolean"===l:try{u=/^(true|1|y|yes)$/i.test(e.toString())?!0:void 0}catch(y){}if(a.not.a["boolean"](u))try{u=/^(false|-1|0|n|no)$/i.test(e.toString())?!1:void 0}catch(y){}u=a.a["boolean"](u)?u:void 0;break;case"date"===l||"datetime"===l:try{u=new Date(e),u=isNaN(u.getTime())?void 0:u}catch(y){}break;case"string"===l:a.a.string(e)&&(u=e),(a.a["boolean"](e)||a.a.number(e))&&(u=e.toString());break;case"number"===l:try{if(a.a.array(e)||a.a.guid(e))throw"wrong number";u=parseFloat(e),(a.not.a.number(u)||isNaN(u))&&(u=void 0)}catch(y){u=void 0}if(void 0!==u)switch(!0){case"integer"===t:u=parseInt(u,10)}break;default:try{u=o(JSON.parse(e),l)}catch(y){}}return p.length>0&&!n(p,u)&&(u=p[0]),c||a.not.undefined(u)?u:a.not.undefined(r)?r:null};t.exports=o},{"sc-contains":3,"sc-is":7}],3:[function(e,t,r){var n=function(e,t){var r=!1;return Array.isArray(e)?e.forEach(function(e){r===!1&&t===e&&(r=!0)}):Object(e)===e&&Object.keys(e).forEach(function(n){r===!1&&e[n]===t&&(r=!0)}),r};t.exports=n},{}],4:[function(e,t,r){var n="{?[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{12}}?";r.generate=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:7&r|8).toString(16)});return t},r.match=function(e){var t=new RegExp(n,"g"),r=("string"==typeof e?e:"").match(t);return Array.isArray(r)?r:[]},r.isValid=function(e){var t=new RegExp(n);return t.test(e)}},{}],5:[function(e,t,r){function n(e,t,r){e="object"===a(e)?e:{},t="array"===a(t)?t:[],r="string"===a(r)?r:"";var i=t.length>0?t.shift():"",s=o.call(e,i)||void 0!==e[i],u=s?e[i]:void 0,c=a(u)===r;return t.length>0&&s?n(e[i],t,r):t.length>0||""===r?s:s&&c}var a=e("type-component"),o=Object.prototype.hasOwnProperty;t.exports=function(e,t,r){return t="string"===a(t)?t.split("."):[],n(e,t,r)}},{"type-component":6}],6:[function(e,t,r){var n=Object.prototype.toString;t.exports=function(e){switch(n.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}},{}],7:[function(e,t,r){var n=e("./ises/type"),a={a:{},an:{},not:{a:{},an:{}}},o={arguments:["arguments",n("arguments")],array:["array",n("array")],"boolean":["boolean",n("boolean")],date:["date",n("date")],"function":["function","func","fn",n("function")],"null":["null",n("null")],number:["number","integer","int",n("number")],object:["object",n("object")],regexp:["regexp",n("regexp")],string:["string",n("string")],undefined:["undefined",n("undefined")],empty:["empty",e("./ises/empty")],nullorundefined:["nullOrUndefined","nullorundefined",e("./ises/nullorundefined")],guid:["guid",e("./ises/guid")]};Object.keys(o).forEach(function(e){var t=o[e].slice(0,o[e].length-1),r=o[e][o[e].length-1];t.forEach(function(e){a[e]=a.a[e]=a.an[e]=r,a.not[e]=a.not.a[e]=a.not.an[e]=function(){return r.apply(this,arguments)?!1:!0}})}),r=t.exports=a,r.type=n},{"./ises/empty":8,"./ises/guid":9,"./ises/nullorundefined":10,"./ises/type":11}],8:[function(e,t,r){var n=e("../type");t.exports=function(e){var t=!1;return"null"===n(e)||"undefined"===n(e)?t=!0:"object"===n(e)?t=0===Object.keys(e).length:"boolean"===n(e)?t=e===!1:"number"===n(e)?t=0===e||-1===e:("array"===n(e)||"string"===n(e))&&(t=0===e.length),t}},{"../type":12}],9:[function(e,t,r){var n=e("sc-guid");t.exports=function(e){return n.isValid(e)}},{"sc-guid":4}],10:[function(e,t,r){t.exports=function(e){return null===e||void 0===e||void 0===e}},{}],11:[function(e,t,r){var n=e("../type");t.exports=function(e){return function(t){return n(t)===e}}},{"../type":12}],12:[function(e,t,r){var n=Object.prototype.toString;t.exports=function(e){switch(n.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===e?"null":void 0===e?"undefined":e===Object(e)?"object":typeof e}},{}],13:[function(e,t,r){var n=e("component-type"),a=function(){var e=Array.prototype.slice.call(arguments),t="boolean"===n(e[0])?e.shift():!1,r=e,o={};return r.forEach(function(e){"object"===n(e)&&Object.getOwnPropertyNames(e).forEach(function(r){Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=t&&"object"===n(e[r])?a(t,{},o[r],e[r]):t&&Array.isArray(e[r])?(Array.isArray(o[r])?o[r]:[]).concat(e[r]):e[r])})}),o};t.exports=a},{"component-type":14}],14:[function(e,t,r){var n=Object.prototype.toString;t.exports=function(e){switch(n.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!==e?"nan":e&&1===e.nodeType?"element":(e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e),typeof e)}},{}],15:[function(e,t,r){var n=function(e){var t={},r=Array.isArray(e)?e:[],n=function(e,n){var a=Array.prototype.slice.call(arguments,1);return t[e]?t[e].apply(r,a):r["__"+e].apply(r,a)};return Object.defineProperties(r,{on:{value:function(e,r){t[e]=r}}}),Object.defineProperty(r,"pop",{value:function(){return n("pop",r[r.length-1])}}),Object.defineProperty(r,"__pop",{value:function(){return Array.prototype.pop.apply(r,arguments)}}),Object.defineProperty(r,"shift",{value:function(){return n("shift",r[0])}}),Object.defineProperty(r,"__shift",{value:function(){return Array.prototype.shift.apply(r,arguments)}}),["push","reverse","unshift","sort","splice"].forEach(function(e){var t={};t[e]={value:n.bind(null,e)},t["__"+e]={value:function(t){return Array.prototype[e].apply(r,arguments)}},Object.defineProperties(r,t)}),r};t.exports=n},{}],16:[function(e,t,r){t.exports={defaults:{baseUrl:"",headers:{}}}},{}],17:[function(e,t,r){var n=e("./config.json"),a={adapters:{__default:void 0},use:function(e){if(!(e&&e.name&&e.create&&e.find&&e.findOne&&e.save&&e.destroy))throw new Error("Invalid Adapter");this.adapters.__default||(this.adapters.__default=e),this.adapters[e.name]=e}},o=e("./moldy")(e("./model"),n.defaults,a.adapters);a.extend=function(e,t){return new o(e,t)},r=t.exports=a,r.defaults=n.defaults},{"./config.json":16,"./model":19,"./moldy":20}],18:[function(e,t,r){var n=e("sc-is"),a=e("sc-cast"),o=e("sc-merge");r.attributes=function(e,t){var r;return r=n.a.string(t)?{type:t}:n.an.object(t)&&t.__isMoldy===!0?{type:"moldy","default":t}:t,o({name:e||"",type:"","default":null,optional:!1},r)},r.getProperty=function(e){return function(){return this.__data[e]}},r.destroyedError=function(e){var t="object"==typeof e?e:{};return new Error("The given moldy item `"+t.__name+"` has been destroyed")},r.setBusy=function(e){return function(){e.busy=!0}},r.last=function(e){return e&&e.hasOwnProperty("length")?e[Math.max(e.length-1,0)]:null},r.setProperty=function(e){return function(t){var r=this,n=r.__attributes[e],o=Array.isArray(n.values)?n.values:[],i=n.type?a(t,n.type,n["default"],o):t;r.__data[e]!==i&&r.emit("change",r.__data[e],i),r.__data[e]=i}},r.unsetBusy=function(e){return function(){e.busy=!1}},r.noop=function(){};var i=function(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){if(t)for(var r in t)e[r]=t[r]}),e};r.extend=i,r.extendObject=function(e,t){var r,n=this;r=e&&Object.prototype.hasOwnProperty.call(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},i(r,n,t);var a=function(){this.constructor=r};return a.prototype=n.prototype,r.prototype=new a,e&&i(r.prototype,e),r.__super__=n.prototype,r}},{"sc-cast":2,"sc-is":7,"sc-merge":13}],19:[function(e,t,r){var n=e("sc-cast"),a=e("emitter-component"),o=e("sc-guid"),i=e("sc-haskey"),s=e("./helpers"),u=e("sc-is"),c=s.extendObject,l=function(e,t){var r=this,a=e||{};this.__moldy=t,this.__isMoldy=!0,this.__attributes={},this.__data={},this.__destroyed=!1,r.__moldy.__keyless||r.__moldy.$defineProperty(r,r.__moldy.__key),Object.keys(n(r.__moldy.__metadata,"object",{})).forEach(function(e){r.__moldy.$defineProperty(r,e,a[e])})};l.prototype.$clear=function(){var e=this;Object.keys(e.__moldy.__metadata).forEach(function(t){if(i(e[t],"__isMoldy","boolean")&&e[t].__isMoldy===!0)e[t].$clear();else if(e.__attributes[t].arrayOfAType)for(;e[t].length>0;)e[t].shift();else e[t]=e.__data[t]=void 0})},l.prototype.$clone=function(e){var t=this.$json();s.extend(t,e||{});var r=this.__moldy.create(t);return r},l.prototype.$data=function(e,t){var r=this,n=u.object(e)?e:{},a=s.extend({mergeArrayOfAType:!0},t);return r.__destroyed?s.destroyedError(r):(Object.keys(n).forEach(function(e){if(r.__attributes.hasOwnProperty(e))if(u.an.array(n[e])&&i(r.__attributes[e],"arrayOfAType","boolean")&&r.__attributes[e].arrayOfAType===!0){if(a.mergeArrayOfAType!==!0)for(;r[e].length;)r[e].shift();n[e].forEach(function(t){r[e].push(t)})}else u.a.object(n[e])&&r[e]instanceof l?r[e].$data(n[e],t):r[e]=n[e]}),r)},l.prototype.$destroy=function(e){var t=this,r=o.generate(),n=t.$isDirty(),a=t.$json(),i="delete",c=u.a.func(e)?e:s.noop;return t.__destroyed?c.apply(t,[s.destroyedError(t)]):(t.__moldy.emit("busy",r),t.emit("predestroy",{moldy:t,data:a,method:i,callback:c}),void(n?c&&c(new Error("This moldy cannot be destroyed because it has not been saved to the server yet.")):t.__moldy.__adapter[t.__moldy.__adapterName].destroy.call(t.__moldy,t.$json(),function(e,n){!e||e instanceof Error||(e=new Error("An unknown error occurred")),t.__moldy.emit("busy:done",r),t.emit("destroy",e,n),t.__destroyed=!0,t[t.__moldy.__key]=void 0,c&&c(e,n)})))},l.prototype.$isDirty=function(){return this.__destroyed?!0:u.empty(this[this.__moldy.__key])},l.prototype.$isValid=function(){if(this.__destroyed)return!1;var e=this,t=!0;return Object.keys(e.__attributes).forEach(function(r){if(!e.$isDirty()||r!==e.__moldy.__key){var n=e[r],a=e.__attributes[r],o=a.type,s=i(a,"arrayOfAType","boolean")?a.arrayOfAType===!0:!1,c=a.optional!==!0,p=e.__moldy.__keyless?!1:s?0===n.length:u.nullOrUndefined(n),y=u.not.empty(o)&&u.a.string(o)?u.not.a[o](n):p;s&&u.not.empty(n)&&n[0]instanceof l&&n.forEach(function(e){t&&e.$isValid()===!1&&(t=!1)}),t&&c&&y&&(t=!1)}}),t},l.prototype.$json=function(){var e=this,t=e.__data,r={};return Object.keys(t).forEach(function(e){u.an.array(t[e])&&t[e][0]instanceof l?(r[e]=[],t[e].forEach(function(t){r[e].push(t.$json())})):r[e]=u.a.date(t[e])?t[e].toISOString():t[e]instanceof l?t[e].$json():t[e]}),r},l.prototype.$save=function(e,t){var r=this,a=null,c=o.generate(),l=r.$isDirty(),p=n(e,"object",r.$json()),y=l?"create":"save",f=s.last(arguments);f=u.a.func(f)?f:s.noop,r.__destroyed=!1,r.__moldy.emit("busy",c),r.emit("presave",{moldy:r,data:p,method:y,callback:f});var d=i(p,r.__key)&&u.not.empty(p[r.__key]);r.__moldy.__adapter[r.__moldy.__adapterName][y].call(r.__moldy,p,function(e,t){!e||e instanceof Error||(e=new Error("An unknown error occurred")),!e&&l&&u.object(t)&&d&&!i(t,r.__moldy.__key)&&(e=new Error("The response from the server did not contain a valid `"+r.__moldy.__key+"`")),!e&&l&&u.object(t)&&(r.__moldy[r.__moldy.__key]=t[r.__moldy.__key]),a||r.$data(t,{mergeArrayOfAType:!1}),r.emit("save",e,r),r.__moldy.emit("busy:done",c),f&&f(e,r)})},a(l.prototype),l.extend=c,r=t.exports=l},{"./helpers":18,"emitter-component":1,"sc-cast":2,"sc-guid":4,"sc-haskey":5,"sc-is":7}],20:[function(e,t,r){var n=e("./helpers/index"),a=e("emitter-component"),o=e("sc-guid"),i=e("sg-observable-array"),s=e("sc-haskey"),u=e("sc-is"),c=e("sc-merge"),l=e("sc-cast");t.exports=function(e,t,r){var p=function(e,r){{var n=this,a=u.an.object(r)?r:{};a.initial||{}}Object.defineProperties(n,{__moldy:{value:!0},__properties:{value:a.properties||{}},__adapterName:{value:a.adapter||"__default"},__metadata:{value:{}},__baseUrl:{value:l(a.baseUrl,"string",""),writable:!0},__data:{value:{},writable:!0},__destroyed:{value:!1,writable:!0},__headers:{value:c({},l(a.headers,"object",{}),l(t.headers,"object",{})),writable:!0},__key:{value:l(a.key,"string","id")||"id",writable:!0},__keyless:{value:a.keyless===!0},__name:{value:e||a.name||"",writable:!0},__url:{value:l(a.url,"string",""),writable:!0},busy:{value:!1,writable:!0}}),n.__keyless||this.$property(this.__key),Object.keys(l(n.__properties,"object",{})).forEach(function(e){n.$property(e,n.__properties[e])})};return p.prototype.schema=function(e){return Object.keys(l(e,"object",{})).forEach(function(t){self.$property(t,e[t])}),this},p.prototype.adapter=function(e){if(!e||!this.__adapter[e])throw new Error("Provide a valid adpater ");return this.__adapterName=e,this},p.prototype.proto=function(e){return this.__properties.proto=this.__properties.proto||{},n.extend(this.__properties.proto,e),this},p.prototype.create=function(t){var r=e.extend(this.__properties.proto||{});return new r(t,this)},p.prototype.$headers=function(e){var t=this;return t.__destroyed?n.destroyedError(t):(t.__headers=u.an.object(e)?e:t.__headers,u.not.an.object(e)?t.__headers:t)},p.prototype.$findOne=function(e,t){{var r,a=this,i=o.generate(),s=a.$url(),c="findOne",l=u.an.object(e)?e:{},p=u.a.func(e)?e:u.a.func(t)?t:n.noop;a.__destroyed}a.emit("busy",i),a.emit("prefindOne",{moldy:a,method:c,query:l,url:s,callback:p}),a.__destroyed=!1,a.__adapter[a.__adapterName].findOne.call(a,l,function(e,t){!e||e instanceof Error||(e=new Error("An unknown error occurred")),r=u.empty(t)?void 0:a.create(u.array(t)?t[0]:t),a.emit("busy:done",i),a.emit("findOne",e,r),p&&p(e,r)})},p.prototype.$url=function(e){var t=this,r=u.empty(t.$baseUrl())?"":t.$baseUrl(),n=u.empty(t.__name)?"":"/"+t.__name.trim().replace(/^\//,""),a=e||t.__url||"",o=r+n+(u.empty(a)?"":"/"+a.trim().replace(/^\//,""));return t.__url=a.trim().replace(/^\//,""),u.not.a.string(e)?o:t},p.prototype.__adapter=r,p.prototype.$baseUrl=function(e){var r=this,n=l(e,"string",r.__baseUrl||"");return r.__baseUrl=n.trim().replace(/(\/|\s)+$/g,"")||t.baseUrl||"",u.not.a.string(e)?r.__baseUrl:r},p.prototype.$find=function(t,r){var a=this,i=o.generate(),s=a.$url(),c="find",p=[],y=u.an.object(t)?t:{},f=u.a.func(t)?t:u.a.func(r)?r:n.noop;a.emit("busy",i),a.emit("prefind",{moldy:a,method:c,query:y,url:s,callback:f}),a.__adapter[a.__adapterName].find.call(a,y,function(t,r){!t||t instanceof t||(t=new Error("An unknown error occurred")),u.array(r)?r.forEach(function(e){p.push(a.create(e))}):p.push(a.create(_data));var n=l(p instanceof e||u.an.array(p)?p:null,"array",[]);a.emit("busy:done",i),a.emit("find",t,n),f&&f(t,n)})},p.prototype.$defineProperty=function(e,t,r){var a=this,o=e[t]||r,s=a.__metadata[t];if(!e.hasOwnProperty(t)||!e.__attributes.hasOwnProperty(t)){if((s.valueIsAnArrayMoldy||s.valueIsAnArrayString)&&(s.attributes.type=s.value,s.attributeArrayTypeIsAMoldy=s.valueIsAnArrayMoldy,s.attributeArrayTypeIsAString=s.valueIsAnArrayString,s.attributeTypeIsAnArray=!0),s.attributeTypeIsAnInstantiatedMoldy)Object.defineProperty(e,t,{value:s.attributes["default"],enumerable:!0}),e.__data[t]=e[t];else if(s.valueIsAStaticMoldy)Object.defineProperty(e,t,{value:new p(s.value.name,s.value).create(o),enumerable:!0}),e.__data[t]=e[t];else if(s.attributeTypeIsAnArray){var c=i([]),y=s.attributeArrayTypeIsAString||s.attributeArrayTypeIsAMoldy?s.attributes.type[0]:"*";s.attributes.arrayOfAType=!0,Object.defineProperty(e,t,{value:c,enumerable:!0}),e.__data[t]=e[t],["push","unshift"].forEach(function(e){c.on(e,function(){var t=Array.prototype.slice.call(arguments),r=[];return t.forEach(function(e){if(s.attributeArrayTypeIsAMoldy){var t=new p(y.name,y),n=u.an.object(e)?e:s.attributes["default"];r.push(t.create(n))}else r.push(l(e,y,s.attributes["default"]))}),c["__"+e].apply(c,r)})}),o&&o.length>0&&o.forEach(function(r){e[t].push(r)})}else Object.defineProperty(e,t,{get:n.getProperty(t),set:n.setProperty(t),enumerable:!0});e.__attributes[t]=s.attributes}void 0!==o?e[t]=o:u.empty(e[t])&&s.attributes.optional===!1&&u.not.nullOrUndefined(s.attributes["default"])?e[t]=s.attributes["default"]:u.empty(e[t])&&s.attributes.optional===!1&&(e.__data[t]=s.attributeTypeIsAnArray||s.attributeTypeIsAnInstantiatedMoldy?e[t]:u.empty(s.attributes.type)?void 0:l(void 0,s.attributes.type))},p.prototype.$property=function(e,t){var r=this,a=new n.attributes(e,t),o=u.a.string(a.type)&&/moldy/.test(a.type),i=u.an.array(a.type),c=u.an.array(t)&&s(t[0],"properties","object"),l=u.an.array(t)&&u.a.string(t[0]),p=i&&s(a.type[0],"properties","object"),y=i&&u.a.string(a.type[0])&&u.not.empty(a.type[0]),f=s(t,"properties","object");return r.__metadata[e]={attributes:a,value:t,attributeTypeIsAnInstantiatedMoldy:o,attributeTypeIsAnArray:i,valueIsAnArrayMoldy:c,valueIsAnArrayString:l,attributeArrayTypeIsAMoldy:p,attributeArrayTypeIsAString:y,valueIsAStaticMoldy:f},r},a(p.prototype),p}},{"./helpers/index":18,"emitter-component":1,"sc-cast":2,"sc-guid":4,"sc-haskey":5,"sc-is":7,"sc-merge":13,"sg-observable-array":15}]},{},[17])(17)});